(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{"6eb0":function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",[i("q-breadcrumbs",{staticClass:"q-mb-md"},[i("q-breadcrumbs-el",{attrs:{to:"/dashboard",label:"Inicio"}}),i("q-breadcrumbs-el",{attrs:{to:"/menu",label:"Categorias"}}),i("q-breadcrumbs-el",{attrs:{label:t.$route.query.name}})],1),i("div",{staticClass:"text-right q-ma-lg"},[i("q-btn",{attrs:{push:"",color:"indigo-13",icon:"add",label:"agregar nuevo"},on:{click:function(e){t.dialog=!0}}})],1),i("q-markup-table",{attrs:{bordered:"",separator:"horizontal"}},[i("thead",{staticClass:"bg-indigo-14"},[i("tr",[i("th",{attrs:{colspan:"6"}},[i("div",{staticClass:"row no-wrap items-center"},[i("div",{staticClass:"text-h4 q-ml-md text-white"},[t._v(t._s(t.$route.query.name))])])])]),i("tr",{staticClass:"text-white"},[i("th",{staticClass:"text-right"},[t._v("Imagen")]),i("th",{staticClass:"text-left"},[t._v("Producto")]),i("th",{staticClass:"text-right"},[t._v("Precio")]),i("th",{staticClass:"text-right"},[t._v("Modificadores")]),i("th",{staticClass:"text-right"},[t._v("Disponibilidad")]),i("th",{staticClass:"text-right"})])]),i("tbody",[t._l(t.productos,(function(e,o){return i("tr",{key:o},[i("td",{staticClass:"text-right"},[""!=e.image?i("q-avatar",{staticClass:"q-mb-sm",attrs:{size:"40px"}},[i("img",{attrs:{src:e.image}})]):t._e()],1),i("td",{staticClass:"text-left"},[t._v(t._s(e.name))]),i("td",{staticClass:"text-right"},[t._v("$"+t._s(t._f("numfix")(e.price)))]),i("td",{staticClass:"text-right"},[t._v(t._s(t._f("modi")(e.modificador)))]),i("td",{staticClass:"text-right"},[t._v(t._s(t._f("dispo")(e.status)))]),i("td",{staticClass:"text-right"},[i("q-btn",{attrs:{flat:"",round:"",color:"indigo-14",icon:"edit"},on:{click:function(e){return t.editDialog(o)}}}),i("q-btn",{attrs:{flat:"",round:"",color:"red",icon:"delete"},on:{click:function(e){return t.deleteDialog(o)}}})],1)])})),0===t.productos.length?i("tr",[i("td",{attrs:{colspan:"6"}},[t._v("No hay productos aún")])]):t._e()],2)]),i("q-dialog",{model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("q-card",{staticStyle:{width:"600px","max-width":"80vw"}},[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Agregar Producto")])]),i("q-separator"),i("q-card-section",[i("ProdForm",{attrs:{cat_id:t.$route.params.id,item:{}},on:{submited:t.submited}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"cerrar",color:"grey"}})],1)],1)],1),i("q-dialog",{model:{value:t.edit,callback:function(e){t.edit=e},expression:"edit"}},[i("q-card",{staticStyle:{width:"600px","max-width":"80vw"}},[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("Editar Producto")])]),i("q-separator"),i("q-card-section",[i("ProdForm",{attrs:{cat_id:t.$route.params.id,item:t.actionItem},on:{submited:t.edited}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"cerrar",color:"grey"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.confirm,callback:function(e){t.confirm=e},expression:"confirm"}},[i("q-card",[i("q-card-section",{staticClass:"row items-center"},[i("q-avatar",{attrs:{icon:"delete",color:"red","text-color":"white"}}),i("span",{staticClass:"q-ml-sm"},[t._v("¿Deseas eliminar este elemento?.")])],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancelar",color:"indigo-14"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Eliminar",color:"indigo-14"},on:{click:t.deleteItem}})],1)],1)],1)],1)},a=[],r=(i("7f7f"),i("ac6a"),i("cadf"),i("6b54"),i("06db"),i("a481"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("form",{staticClass:"q-gutter-md",attrs:{action:"#"},on:{submit:function(e){return e.preventDefault(),t.submit(e)}}},[i("q-input",{attrs:{filled:"",label:"Nombre del producto",required:"",dense:"",rules:[function(t){return t&&t.length>3||"Ingrese un valor válido"}]},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}}),i("q-input",{attrs:{filled:"",counter:"",maxlength:"200",label:"Descripción del producto",dense:""},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}}),i("q-input",{attrs:{filled:"",label:"Precio del producto",required:"",dense:"",rules:[function(t){return t&&t>0||"Ingrese un valor válido"}]},model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}}),t.modificador?t._e():i("div",{staticClass:"text-center"},[i("q-btn",{attrs:{push:"",color:"indigo-14",size:"12px",label:"agregar  modificador"},on:{click:t.addModificador}})],1),t.modificador?i("div",{staticClass:"text-center"},[i("q-btn",{attrs:{push:"",color:"red-14",size:"12px",label:"eliminar  modificador"},on:{click:t.deleteModificador}})],1):t._e(),t.modificador?i("div",{staticClass:"q-gutter-sm"},[i("p",[t._v("Modificador:")]),i("q-input",{attrs:{filled:"",label:"Nombre del modificador",placeholder:"Ejemplo: Selecciona un tamaño",dense:""},model:{value:t.form.modificador.name,callback:function(e){t.$set(t.form.modificador,"name",e)},expression:"form.modificador.name"}}),i("br"),t._l(t.form.modificador.values,(function(e,o){return i("div",{key:o,staticClass:"row q-mb-sm q-col-gutter-sm"},[i("div",{staticClass:"col"},[i("q-input",{attrs:{filled:"",label:"Modificador",placeholder:"Ejemplo: Chico",dense:""},on:{change:function(e){t.modificador=!1,t.modificador=!0}},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"item.name"}})],1),i("div",{staticClass:"col"},[i("q-input",{attrs:{filled:"",label:"Costo adicional",dense:""},on:{change:function(e){t.modificador=!1,t.modificador=!0}},model:{value:e.price,callback:function(i){t.$set(e,"price",i)},expression:"item.price"}})],1)])})),i("div",{staticClass:"text-center q-gutter-sm"},[i("q-btn",{attrs:{push:"",round:"",color:"red-14",size:"12px",icon:"remove"},on:{click:t.removeRow}}),i("q-btn",{attrs:{push:"",round:"",color:"indigo-14",size:"12px",icon:"add"},on:{click:t.addRow}})],1),i("q-separator",{attrs:{inset:""}})],2):t._e(),i("div",{staticClass:"text-center",attrs:{id:"preview"}},[t.file_url?i("img",{staticStyle:{"max-height":"300px"},attrs:{src:t.file_url}}):t._e()]),i("div",{staticClass:"text-center"},[""!=t.file_url?i("q-btn",{attrs:{outline:"",icon:"close",color:"indigo-14",size:"sm",label:"Eliminar imagen"},on:{click:t.detachImage}}):t._e()],1),i("q-input",{attrs:{filled:"",dense:"",type:"file",hint:"Agregar imagen"},on:{change:t.onFileChange},model:{value:t.file,callback:function(e){t.file=e},expression:"file"}}),i("div",{staticClass:"text-center q-mt-md"},[i("q-btn-toggle",{attrs:{push:"","toggle-color":"indigo-14",options:[{label:"Disponible",value:1},{label:"Agotado",value:0}]},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}}),i("q-btn",{staticClass:"full-width q-mt-lg",attrs:{push:"",color:"indigo-14",icon:"save",type:"submit",label:"guardar"}})],1)],1)])}),s=[],n=(i("551c"),i("967e")),c=i.n(n),d=(i("96cf"),i("fa84")),l=i.n(d),u=(i("456d"),i("8aa5")),m=i.n(u),f={name:"ProdForm",props:{cat_id:{type:String,required:!0},item:{type:Object,default:{}}},data:function(){return{id:0,uid:"",file_url:"",file:null,form:{name:"",price:0,image:"",description:"",status:1,modificador:{}},modificador:!1}},mounted:function(){this.uid=m.a.auth().currentUser.uid,0!==Object.keys(this.item).length&&(this.id=this.item.id,this.form.name=this.item.name,this.form.description=this.item.description,this.form.price=this.item.price,this.form.status=+this.item.status,this.form.modificador=this.item.modificador,this.form.image=this.item.image,this.file_url=this.item.image,0!==Object.keys(this.item.modificador).length&&(this.modificador=!0))},methods:{submit:function(){var t=l()(c.a.mark((function t(){var e,i,o,a;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this,new FormData,this.$q.loading.show({message:"Guardando ..."}),null===this.file){t.next=7;break}return t.next=6,this.uploadFile();case 6:this.form.image=t.sent;case 7:0!==Object.keys(this.item).length&&""!==this.item.image&&this.item.image!==this.form.image&&(i=m.a.storage().refFromURL(this.item.image),i.delete()),o=m.a.firestore(),a={uid:this.uid,cat_id:this.cat_id,name:this.form.name,price:this.form.price,description:this.form.description,image:this.form.image,modificador:this.form.modificador,status:this.form.status},0!==Object.keys(this.item).length?o.collection("products_"+this.uid).doc(this.id).update(a).then((function(){a.id=e.id,e.$q.loading.hide(),e.$emit("submited",a)})).catch((function(t){console.error("Error updating document: ",t)})):o.collection("products_"+this.uid).add(a).then((function(t){a.id=t.id,e.$q.loading.hide(),e.$emit("submited",a)})).catch((function(t){console.error("Error adding document: ",t)}));case 11:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),addModificador:function(){this.modificador=!0,this.form.modificador={},this.form.modificador.values=[],this.addRow()},deleteModificador:function(){this.modificador=!1,this.form.modificador={}},addRow:function(){this.modificador=!1,this.form.modificador.values.push({name:"",price:0}),this.modificador=!0},removeRow:function(){this.modificador=!1,this.form.modificador.values.pop(),this.modificador=!0},uploadFile:function(){var t=l()(c.a.mark((function t(){var e;return c.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this,t.abrupt("return",new Promise((function(t,i){var o=m.a.storage().ref(),a=e.file,r=o.child("categories_"+e.uid+"/"+e.cat_id+"/"+e.form.name+a.name).put(a);r.on(m.a.storage.TaskEvent.STATE_CHANGED,(function(t){var e=t.bytesTransferred/t.totalBytes*100;console.log("Upload is "+e+"% done")}),(function(t){console.log(t),i()}),(function(){r.snapshot.ref.getDownloadURL().then((function(e){t(e)}))}))})));case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onFileChange:function(t){var e=t.target.files[0];e.size>4194304?this.$q.notify({color:"warning",message:"La imagen es muy grande",icon:"warning",position:"center"}):"image/jpeg"!=e.type&&"image/png"!=e.type?this.$q.notify({color:"warning",message:"La imagen no tiene un formato valido",icon:"warning",position:"center"}):(this.file=t.target.files[0],this.file_url=URL.createObjectURL(e))},detachImage:function(){this.file=null,this.file_url="",this.form.image=""}}},h=f,p=i("2877"),g=i("eebe"),b=i.n(g),v=i("27f9"),q=i("9c40"),x=i("eb85"),_=i("6a67"),C=Object(p["a"])(h,r,s,!1,null,null,null),w=C.exports;b()(C,"components",{QInput:v["a"],QBtn:q["a"],QSeparator:x["a"],QBtnToggle:_["a"]});var k={name:"Products",components:{ProdForm:w},data:function(){return{buscar:"",uid:"",dialog:!1,edit:!1,confirm:!1,productos:[],actionIndex:0,actionItem:{}}},mounted:function(){var t=this;this.uid=m.a.auth().currentUser.uid;var e=m.a.firestore();e.collection("products_"+this.uid).where("cat_id","==",this.$route.params.id).get().then((function(e){e.forEach((function(e){var i=e.data();i.id=e.id,t.productos.push(i)}))}))},methods:{submited:function(t){this.productos.push(t),console.log(this.productos),this.dialog=!1,this.$q.notify({message:"Se ha agregado el producto",color:"green"})},editDialog:function(t){this.edit=!0,this.actionIndex=t,this.actionItem=this.productos[this.actionIndex],console.log(this.actionItem)},edited:function(t){this.productos[this.actionIndex]=t,console.log(this.productos[this.actionIndex]),this.edit=!1,this.$q.notify({message:"Se ha editado el producto",color:"green"})},deleteDialog:function(t){this.confirm=!0,this.actionIndex=t,console.log(this.actionIndex)},deleteItem:function(){var t=this,e=this.productos[this.actionIndex],i=m.a.firestore();i.collection("categories_"+this.uid).doc(e.id).delete().then((function(){if(""!==e.image){var i=m.a.storage().refFromURL(e.image);i.delete()}t.productos.splice(t.actionIndex,1)})).catch((function(t){console.error("Error removing document: ",t)}))}},filters:{numfix:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},modi:function(t){var e="";return null!=t.values&&t.values.forEach((function(t){e+=t.name+" | "})),e},dispo:function(t){return 1==t?"Disponible":"Agotado"}}},y=k,I=i("9989"),$=i("ead5"),Q=i("079e"),E=i("65c6"),D=i("6ac5"),P=i("0016"),S=i("2bb1"),j=i("068f"),F=i("cb32"),R=i("24e8"),T=i("f09f"),z=i("a370"),A=i("4b7e"),M=i("7f67"),N=Object(p["a"])(y,o,a,!1,null,null,null);e["default"]=N.exports;b()(N,"components",{QPage:I["a"],QBreadcrumbs:$["a"],QBreadcrumbsEl:Q["a"],QToolbar:E["a"],QToolbarTitle:D["a"],QInput:v["a"],QIcon:P["a"],QBtn:q["a"],QMarkupTable:S["a"],QImg:j["a"],QAvatar:F["a"],QDialog:R["a"],QCard:T["a"],QCardSection:z["a"],QSeparator:x["a"],QCardActions:A["a"]}),b()(N,"directives",{ClosePopup:M["a"]})}}]);